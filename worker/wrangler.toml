name = "nerdiversary-calendar"
main = "worker.js"
compatibility_date = "2024-01-01"

# Optional: Add a custom domain later
# routes = [
#   { pattern = "calendar.nerdiversary.com", custom_domain = true }
# ]

# ============================================================================
# Push Notification Configuration
# ============================================================================
#
# Architecture: O(1) cron reads using time-bucketed scheduling
# - On subscribe: pre-calculate notifications for next 30 days, store by minute
# - Every minute: read ONE KV key for current minute, send those notifications
# - Cost: 1 KV read per minute (1,440/day) regardless of subscriber count
#
# To enable push notifications:
#
# 1. Create KV namespaces:
#    wrangler kv:namespace create PUSH_SUBSCRIPTIONS
#    wrangler kv:namespace create SCHEDULED_NOTIFICATIONS
#
# 2. Generate VAPID keys (one-time):
#    npx web-push generate-vapid-keys
#
# 3. Set the VAPID keys as secrets:
#    wrangler secret put VAPID_PUBLIC_KEY
#    wrangler secret put VAPID_PRIVATE_KEY
#    wrangler secret put VAPID_SUBJECT   # e.g., "mailto:you@example.com"
#
# 4. Uncomment the KV bindings below and add your namespace IDs
# ============================================================================

# KV namespace bindings for push notifications
# Uncomment and add your namespace IDs after running `wrangler kv:namespace create`
# [[kv_namespaces]]
# binding = "PUSH_SUBSCRIPTIONS"
# id = "your-push-subscriptions-namespace-id"
#
# [[kv_namespaces]]
# binding = "SCHEDULED_NOTIFICATIONS"
# id = "your-scheduled-notifications-namespace-id"

# Scheduled trigger - runs every minute to check for notifications
# Cost: 1 KV read per minute (O(1) regardless of subscriber count)
[triggers]
crons = ["* * * * *"]
