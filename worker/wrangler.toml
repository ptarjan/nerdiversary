name = "nerdiversary-calendar"
main = "worker.js"
compatibility_date = "2024-01-01"

# Optional: Add a custom domain later
# routes = [
#   { pattern = "calendar.nerdiversary.com", custom_domain = true }
# ]

# ============================================================================
# Push Notification Configuration
# ============================================================================
#
# Architecture: Birthday-indexed D1 queries (scales to 1M+ users)
# - On subscribe: store subscription + family birthdates in D1
# - Every minute: query birthdates matching any milestone offset, send notifications
# - Cost: ~1 query/minute + ~few reads (O(1) regardless of user count)
#
# To enable push notifications:
#
# 1. Create D1 database:
#    wrangler d1 create nerdiversary-db
#
# 2. Run schema migration:
#    wrangler d1 execute nerdiversary-db --file=./schema.sql
#
# 3. Generate VAPID keys (one-time):
#    npx web-push generate-vapid-keys
#
# 4. Set the VAPID keys as secrets:
#    wrangler secret put VAPID_PUBLIC_KEY
#    wrangler secret put VAPID_PRIVATE_KEY
#    wrangler secret put VAPID_SUBJECT   # e.g., "mailto:you@example.com"
#
# 5. Uncomment the D1 binding below and add your database ID
# ============================================================================

# D1 database binding for push notifications
[[d1_databases]]
binding = "DB"
database_name = "nerdiversary-db"
database_id = "a9e7cd62-6a7f-4ea1-9671-6794ecf2b59d"

# Scheduled trigger - runs every minute to check for notifications
# Cost: 1 D1 query per minute (scales to millions of users)
[triggers]
crons = ["* * * * *"]
